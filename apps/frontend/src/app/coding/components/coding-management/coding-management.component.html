<div class="coding-main-container">
  <div>
    <div class="action-buttons-toolbar">
      @if (!showManualCoding) {
      <a mat-raised-button color="primary" (click)="onAutoCode()">
        <mat-icon>auto_fix_high</mat-icon>
        {{ 'coding-management.buttons.auto-code' | translate }}
      </a>
      }
      <a mat-raised-button [color]="showManualCoding ? 'accent' : 'primary'" (click)="toggleManualCoding()">
        <mat-icon>{{ showManualCoding ? 'arrow_back' : 'keyboard' }}</mat-icon>
        {{ showManualCoding ? ('coding-management.buttons.back-to-overview' | translate) :
        ('coding-management.buttons.manual-code' | translate) }}
      </a>

      @if (!showManualCoding) {
      @if (codingListDownloadProgress !== null) {
      <button mat-raised-button disabled class="progress-button">
        <mat-spinner diameter="20" class="inline-spinner"></mat-spinner>
        {{ 'coding-management.descriptions.coding-list-progress' | translate:{progress: codingListDownloadProgress} }}
      </button>
      } @else {
      <a mat-raised-button color="primary" (click)="fetchCodingList()">
        <mat-icon>list</mat-icon>
        {{ 'coding-management.buttons.coding-list' | translate }}
      </a>
      }
      }
      @if (!showManualCoding) {
      <a mat-raised-button color="primary" (click)="openExportCodingBook()">
        <mat-icon>book</mat-icon>
        {{ 'coding-management.buttons.codebook' | translate }}
      </a>
      }
      @if (!showManualCoding) {
      <a mat-raised-button color="primary" (click)="openItemListDialog()">
        <mat-icon>list_alt</mat-icon>
        {{ 'Itemliste' }}
      </a>
      }
      @if (!showManualCoding) {
      <a mat-raised-button color="primary" (click)="fetchVariableAnalysis()">
        <mat-icon>analytics</mat-icon>
        {{ 'coding-management.buttons.item-variable-analysis' | translate }}
      </a>
      }
      @if (!showManualCoding) {
      <a mat-raised-button color="primary" (click)="fetchUnitVariables()">
        <mat-icon>list_alt</mat-icon>
        {{ 'coding-management.buttons.coding-variables' | translate }}
      </a>
      }
    </div>
  </div>

  @if (!showManualCoding) {
  <div class="coding-content-area">
    <div class="content-row-container">
      <!-- Statistics Section -->
      <div class="statistics-section">
        <app-statistics-card [codingStatistics]="codingStatistics" [referenceStatistics]="referenceStatistics"
          [referenceVersion]="referenceVersion" [selectedVersion]="selectedStatisticsVersion"
          [isLoading]="isLoadingStatistics" [isDownloadInProgress]="isDownloadInProgress"
          [statisticsLoaded]="statisticsLoaded" [resetProgress]="resetProgress" [downloadProgress]="downloadProgress"
          (versionChange)="onVersionChange($event)" (loadStatistics)="fetchCodingStatistics()"
          (downloadResults)="onDownloadResults()" (resetVersion)="onResetVersion()"
          (statusClick)="onStatusClick($event)">
        </app-statistics-card>
      </div>

      <!-- Filter Section -->
      <div class="filters-section">
        <app-response-filters [filterParams]="filterParams" [availableStatuses]="getAvailableStatuses()"
          [isLoading]="isLoading" [isGeogebraAvailable]="isGeogebraAvailable" (filterChange)="onFilterChange($event)"
          (clearFilters)="onClearFilters()">
        </app-response-filters>
      </div>

      <!-- Data Section -->
      <div class="data-section">
        <app-response-table [data]="data" [displayedColumns]="displayedColumns" [totalRecords]="totalRecords"
          [pageSize]="pageSize" [pageIndex]="pageIndex" [pageSizeOptions]="pageSizeOptions" [isLoading]="isLoading"
          [currentStatusFilter]="currentStatusFilter" [selectedVersion]="selectedStatisticsVersion"
          [isGeogebraFilterActive]="filterParams.geogebra" (pageChange)="onPageChange($event)"
          (replayClick)="onReplayClick($event)" (showCodingScheme)="onShowCodingScheme($event)"
          (showUnitXml)="onShowUnitXml($event)" (reviewClick)="onReviewClick()">
        </app-response-table>
      </div>
    </div>
  </div>
  }

  <!-- Manual Coding Management Content -->
  @if (showManualCoding) {
  <coding-box-coding-management-manual></coding-box-coding-management-manual>
  }
</div>