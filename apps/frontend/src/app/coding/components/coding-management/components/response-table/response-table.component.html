@if (isLoading) {
<div class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p class="loading-text">{{ 'coding-management.loading.processing-data' | translate }}</p>
</div>
}

@if (!isLoading && data.length > 0) {
<div class="data-card">
    <div class="card-header">
        <h2 class="section-title">{{ 'coding-management.titles.coding-data' | translate }}</h2>
        @if (currentStatusFilter) {
        <div class="current-status">
            <h3>
                @if (currentStatusFilter === 'null') {
                {{ 'coding-management.statistics.uncoded-responses-title' | translate }}
                } @else {
                {{ 'coding-management.statistics.responses-with-status-title' | translate:{status:
                mapStatusToString(Number(currentStatusFilter))} }}
                }
            </h3>
        </div>
        }
    </div>
    <mat-divider></mat-divider>
    <div class="table-container">
        <table mat-table [dataSource]="dataSource" matSort class="coding-table">
            @for (column of displayedColumns; track column) {
            <ng-container matColumnDef="{{ column }}">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ getColumnHeader(column) }} </th>
                <td mat-cell *matCellDef="let element"
                    [attr.colspan]="element.id === 0 ? displayedColumns.length : null">
                    @if (element.id === 0) {
                    <ng-container class="group-header">
                        <strong class="group-header-text">{{ element.unitname || element.variableid }}</strong>
                    </ng-container>
                    }
                    @if (element.id !== 0) {
                    @if (column === 'actions') {
                    <div class="action-buttons-container">
                        <button mat-icon-button color="primary" (click)="onReplayClick(element)"
                            [matTooltip]="'coding-management.tooltips.view-in-replay' | translate"
                            class="action-button">
                            <mat-icon>play_circle_filled</mat-icon>
                        </button>
                        <button mat-icon-button color="primary" (click)="onShowCodingScheme(element.unit.name)"
                            [matTooltip]="'coding-management.tooltips.show-coding-schema' | translate"
                            class="action-button">
                            <mat-icon>code</mat-icon>
                        </button>
                    </div>
                    } @else if (column === 'unitname') {
                    <span class="clickable-cell" (click)="onShowUnitXml(element.unit.name)"
                        [matTooltip]="'coding-management.tooltips.show-unit-xml' | translate">
                        {{ element[column] }}
                    </span>
                    } @else {
                    @if (column === 'codedstatus') {
                    {{ getStatusString(element[column]) }}
                    } @else if (column === 'code') {
                    {{ element[column] }}
                    } @else if (column === 'score') {
                    {{ element[column] }}
                    } @else if (column === 'person_code') {
                    {{ element.person_code || element.login_code }}
                    } @else if (column === 'person_login') {
                    {{ element.login_name }}
                    } @else if (column === 'person_group') {
                    {{ element.person_group || element.login_group }}
                    } @else if (column === 'booklet_id') {
                    {{ element.booklet_id }}
                    } @else {
                    {{ element[column] }}
                    }
                    }
                    }
                </td>
            </ng-container>
            }
            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="data-row"></tr>
        </table>
        <mat-paginator [length]="totalRecords" [pageSize]="pageSize" [pageIndex]="pageIndex"
            [pageSizeOptions]="pageSizeOptions" showFirstLastButtons (page)="onPageChange($event)">
        </mat-paginator>
    </div>
</div>
}

@if (!isLoading && data.length === 0) {
<div class="empty-state">
    <mat-icon class="empty-icon">code</mat-icon>
    <h3>{{ 'coding-management.descriptions.no-data' | translate }}</h3>
</div>
}