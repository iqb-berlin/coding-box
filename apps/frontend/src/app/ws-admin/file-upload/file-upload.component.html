<div class="fx-column-start-start fx-gap-10 container">
  <a mat-raised-button color="primary" (click)="testCenterImport()">
    <mat-icon>upload</mat-icon>
    Testcenter Import
  </a>
  <a mat-raised-button color="primary" (click)="hiddenFileInput.click()">
    <mat-icon>upload</mat-icon>
    Test Dateien hochladen
  </a>
  <input #hiddenFileInput type="file"
         name="files"
         accept=".xml,.voud,.zip,.html,.csv"
         multiple
         [hidden]="true"
         (change)="onFileSelected($event.currentTarget)"/>
  @if (isLoading) {
    <mat-spinner></mat-spinner>
  }
  @if (!isLoading) {
    @if (dataSource.data.length) {
      <coding-box-search-filter
        [title]="'search-filter.filter-test-persons' | translate"
        (valueChange)="dataSource.filter = $event.trim().toLowerCase()">
      </coding-box-search-filter>
    }
    <mat-table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="selectCheckbox">
        <mat-header-cell *matHeaderCellDef class="fx-flex-row-fix-70">
          <mat-checkbox [checked]="(tableSelectionCheckboxes | hasSelectionValue : tableSelectionCheckboxes.selected.length) &&  (tableSelectionCheckboxes.selected.length | isAllSelected : dataSource.data.length)"
                        [indeterminate]="(tableSelectionCheckboxes | hasSelectionValue : tableSelectionCheckboxes.selected.length) && !(tableSelectionCheckboxes.selected.length | isAllSelected : dataSource.data.length)"
                        (change)="$event ? masterToggle() : null">
          </mat-checkbox>
        </mat-header-cell>
        <mat-cell *matCellDef="let row" class="fx-flex-row-fix-70">
          <mat-checkbox [checked]="tableSelectionCheckboxes | isSelected: row : tableSelectionCheckboxes.selected.length"
                        (click)="$event.stopPropagation()"
                        (change)="$event ? tableSelectionCheckboxes.toggle(row) : null">
          </mat-checkbox>
        </mat-cell>
      </ng-container>
      @for (column of displayedColumns; track column) {
        <ng-container [matColumnDef]="column">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="name"> {{ 'file-upload.' + column | translate}}</th>
          <td mat-cell [innerHTML]="element[column]" *matCellDef="let element"></td>
        </ng-container>
      }
      <tr mat-header-row  *matHeaderRowDef="displayedColumns;sticky:true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </mat-table>
  }
</div>
