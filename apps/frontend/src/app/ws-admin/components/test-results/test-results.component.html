<div class="fx-column-start-start fx-gap-10  container">
  @if ( dataSource && dataSource.data.length) {
    <div class="fx-row-space-between-start">
      <div>
        <div>
          <mat-label>Filter</mat-label>
          <input matInput (input)="applyFilter($event)" placeholder="Suchtext eingeben">
        </div>
        <div class="table-container">
          <mat-spinner *ngIf="isLoading" class="loading-spinner"></mat-spinner>
          <div *ngIf="!isLoading">
            <mat-table [dataSource]="dataSource" matSort>
              <ng-container matColumnDef="code" >
                <mat-header-cell *matHeaderCellDef mat-sort-header="code">
                </mat-header-cell>
                <mat-cell *matCellDef="let element">
                  {{element.code}}
                </mat-cell>
              </ng-container>
              <ng-container matColumnDef="group">
                <mat-header-cell *matHeaderCellDef mat-sort-header="group">{{'test_group.test_group' | translate}}</mat-header-cell>
                <mat-cell *matCellDef="let element">
                  {{element.group}}
                </mat-cell>
              </ng-container>
              <ng-container matColumnDef="login">
                <mat-header-cell *matHeaderCellDef mat-sort-header="login">Login</mat-header-cell>
                <mat-cell *matCellDef="let element">
                  {{element.login}}
                </mat-cell>
              </ng-container>
              <ng-container matColumnDef="uploaded_at">
                <mat-header-cell *matHeaderCellDef mat-sort-header="uploaded_at">Hinzugef√ºgt am</mat-header-cell>
                <mat-cell *matCellDef="let element">
                  {{element.uploaded_at | date: 'dd.MM.yyyy HH:mm'}}
                </mat-cell>
              </ng-container>
              <mat-header-row *matHeaderRowDef="displayedColumns;sticky: true"></mat-header-row>
              <mat-row  (click)="onRowClick(row)"
                        *matRowDef="let row; columns: displayedColumns;"></mat-row>
            </mat-table>
          </div>
        <!-- Paginator -->
        <mat-paginator
          [length]="totalRecords"
          [pageSize]="pageSize"
          [pageIndex]="pageIndex"
          [pageSizeOptions]="[20, 50, 100]"
          showFirstLastButtons
          (page)="onPaginatorChange($event)"
        >
        </mat-paginator>
        </div>
      </div>

      <mat-accordion>
        <mat-expansion-panel *ngFor="let booklet of booklets">
          <mat-expansion-panel-header>
            <mat-panel-title (click)="setSelectedBooklet(booklet)">
              <mat-icon (click)="replayBooklet(booklet)">play_arrow</mat-icon>
              {{ booklet.id }}
            </mat-panel-title>
          </mat-expansion-panel-header>
              <mat-list>
                <mat-list-item
                  *ngFor="let unit of booklet.units"
                  (click)="onUnitClick(unit)"
                  class="hoverable">
                  <span>{{ unit?.alias }}</span>
                </mat-list-item>
              </mat-list>
        </mat-expansion-panel>
      </mat-accordion>
      <mat-list>
        <mat-list-item
          *ngFor="let response of this.responses"
          class="hoverable"
          [matTooltip]="response.value + ' ' + response.status"
          matTooltipPosition="right"
        >
          <div class="fx-row-start-start">
            <div
              [ngStyle]="{ 'background-color': getColor(response.status) }"
              class="square"
              >
            </div>
            <span >{{ response.id }}</span>
          </div>
        </mat-list-item>
      </mat-list>
      <div class="fx-column-start-start">
        <mat-icon (click)="replayUnit()">play_arrow</mat-icon>
      @for ( logBlock of this.logs; track logBlock;) {
            @for ( log of logBlock; track log;) {
              <div class="fx-row-start-start">
                <strong>{{ log.key }}</strong> - {{ log.parameter }}
                <small>{{    formatTimestamp(log.ts) }}</small>
              </div>
            }
      }
      </div>
    </div>
  }
</div>
