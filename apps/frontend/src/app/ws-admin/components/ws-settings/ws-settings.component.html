<div class="wrapper">
  <mat-card class="token-settings-card">
    <mat-card-header>
      <mat-card-title>{{ 'ws-settings.access-token' | translate }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="token-container">
        <h3>{{ 'ws-settings.generate-token' | translate }}</h3>
        <p class="token-description">{{ 'ws-settings.generate-token-description' | translate }}</p>

        <mat-form-field class="full-width">
          <mat-label>{{ 'ws-settings.validity-days' | translate }}</mat-label>
          <input matInput [(ngModel)]="duration" type="number" min="1" placeholder="Laufzeit in Tagen"/>
          <mat-hint>{{ 'ws-settings.enter-validity-days' | translate }}</mat-hint>
        </mat-form-field>

        <div class="token-actions">
          <button mat-raised-button color="primary" [disabled]="!duration || duration < 0" (click)="createToken()">
            <mat-icon>vpn_key</mat-icon> {{ 'ws-settings.generate-access-token' | translate }}
          </button>
        </div>

        @if (authToken) {
          <div class="token-result">
            <h4>{{ 'ws-settings.generated-token' | translate }}</h4>
            <mat-form-field class="full-width token-field">
              <mat-label>{{ 'ws-settings.authorization-token' | translate }}</mat-label>
              <textarea matInput cdkTextareaAutosize [value]="authToken" readonly placeholder="Autorisierungs Token">{{authToken}}</textarea>
              <mat-hint>{{ 'ws-settings.token-api-hint' | translate }}</mat-hint>
            </mat-form-field>
            <div class="token-copy-action">
              <button mat-button color="primary" (click)="copyToken()">
                <mat-icon>content_copy</mat-icon> {{ 'ws-settings.copy-to-clipboard' | translate }}
              </button>
            </div>
          </div>
        }
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="missings-profiles-card">
    <mat-card-header>
      <mat-card-title>{{ 'workspace.coding-missing-profiles' | translate }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="missings-profiles-container">
        <p>{{ 'workspace.edit-missings-profiles-description' | translate }}</p>
        <div class="missings-profiles-actions">
          <button mat-raised-button color="primary" (click)="editMissingsProfiles()">
            <mat-icon>edit</mat-icon> {{ 'workspace.edit-missings-profiles' | translate }}
          </button>
        </div>

        <div class="setting-item">
          <div class="setting-info">
            <h4>Test Results: Person-Matching</h4>
            <p>
              strict: Gruppe + Login + Code
              <br />
              loose: Login + Code
            </p>
          </div>
          <div class="setting-control">
            <mat-form-field appearance="outline">
              <mat-label>Modus</mat-label>
              <mat-select [value]="testResultsPersonMatchMode" (selectionChange)="setTestResultsPersonMatchMode($event.value)">
                <mat-option value="strict">strict</mat-option>
                <mat-option value="loose">loose</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="replay-statistics-card">
    <mat-card-header>
      <mat-card-title>{{ 'ws-settings.replay-statistics' | translate }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="replay-statistics-container">
        <p>{{ 'ws-settings.replay-statistics-description' | translate }}</p>
        <div class="replay-statistics-actions">
          <button mat-raised-button color="primary" (click)="openReplayStatistics()">
            <mat-icon>bar_chart</mat-icon> {{ 'ws-settings.show-replay-statistics' | translate }}
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="coding-settings-card">
    <mat-card-header>
      <mat-card-title>{{ 'ws-settings.coding' | translate }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="coding-settings-container">
        <div class="setting-item">
          <div class="setting-info">
            <h4>{{ 'ws-settings.auto-fetch-coding-statistics' | translate }}</h4>
            <p>{{ 'ws-settings.auto-fetch-coding-statistics-description' | translate }}</p>
          </div>
          <div class="setting-control">
            <mat-slide-toggle
              [checked]="autoFetchCodingStatistics"
              (change)="toggleAutoFetchCodingStatistics($event)">
              {{autoFetchCodingStatistics ? ('ws-settings.enabled' | translate) : ('ws-settings.disabled' | translate)}}
            </mat-slide-toggle>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="access-rights-card">
    <mat-card-header>
      <mat-card-title>
        {{ 'ws-settings.user-rights' | translate }}
        <button 
          mat-icon-button 
          class="help-button"
          (click)="openAccessRightsMatrix()"
          [matTooltip]="'access-matrix.title' | translate">
          <mat-icon>help_outline</mat-icon>
        </button>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <coding-box-ws-access-rights></coding-box-ws-access-rights>
    </mat-card-content>
  </mat-card>

  <mat-card class="journal-card">
    <mat-card-header>
      <mat-card-title>{{ 'ws-settings.system-journal' | translate }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <coding-box-journal></coding-box-journal>
    </mat-card-content>
  </mat-card>

  <mat-card class="database-export-card">
    <mat-card-header>
      <mat-card-title>{{ 'ws-settings.export-test-results' | translate }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="database-export-container">
        <p>{{ 'ws-settings.export-database-description' | translate }}</p>
        <div class="database-export-actions">
          <button
            mat-raised-button
            color="primary"
            [disabled]="isExporting"
            (click)="exportWorkspaceDatabase()">
            <mat-icon>download</mat-icon>
            @if (isExporting) {
              {{ 'ws-settings.exporting' | translate }}
            } @else {
              {{ 'ws-settings.export-database' | translate }}
            }
          </button>
        </div>
        @if (isExporting) {
          <mat-progress-bar mode="indeterminate" class="export-progress"></mat-progress-bar>
        }
      </div>
    </mat-card-content>
  </mat-card>
</div>
